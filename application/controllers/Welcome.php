<?php

/**
 * Created by PhpStorm.
 * User: Cancel
 * Date: 9/1/2017
 * Time: 9:36 AM
 *
 *0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0       0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0           0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0       0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0       0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0       0 0     0 0 0 0 0 0 0 0 0 0 0 0 0 0     0 0     0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0           0 0     0 0 0 0 0 0 0 0 0 0 0 0     0           0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0               0 0     0 0 0 0 0 0 0 0 0 0     0               0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0                   0 0     0 0 0 0 0 0 0 0     0                   0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0                       0 0     0 0 0 0 0 0     0 0                     0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0                           0 0     0 0 0 0     0 0                         0 0 0 0 0 0
 * 0 0 0 0 0 0                               0 0     0 0     0                               0 0 0 0 0
 * 0 0 0 0 0                                   0 0         0                                   0 0 0 0
 * 0 0 0 0                                       0       0                                       0 0 0
 * 0 0 0 0                                         0 0 0 0                                         0 0
 * 0 0 0                                           0 0 0                                           0 0
 * 0 0 0 0                                         0 0 0                                           0 0
 * 0 0 0 0                                       0 0 0 0 0                                       0 0 0
 * 0 0 0 0 0                                   0 0 0 0 0 0 0                                   0 0 0 0
 * 0 0 0 0 0 0                               0 0 0 0 0 0 0 0 0                               0 0 0 0 0
 * 0 0 0 0 0 0 0                           0 0 0 0 0 0 0 0 0 0 0                           0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0                       0 0 0 0 0 0 0 0 0 0 0 0 0                       0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0                   0 0 0 0 0 0 0 0 0 0 0 0 0 0 0                   0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0               0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0               0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0           0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0           0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0       0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0       0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0   0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0   0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 * 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 */
class welcome extends Base
{

    public function database()
    {
//        $this->load->model('socket_model');
//        $this->socket_model->connect();
    }

    public function flatui()
    {
        $data = $this->load->view('flat',array(),true);
        $this->request_success($data);
    }

    public function show_message()
    {
//        sleep(5);

        for($i = 0;$i<10000;++$i)
        {
            $result = $this->db->select()->get('pages')->result_array();
        }

        $data = $this->load->view('welcome/show_message',array(),true);
        $this->request_success($data);
    }

    public function editor()
    {
        if(!isset($_GET['proid']))
        {
            show_404('您无权访问该页面');
        }
        $data = $this->load->view('editorView',array('proid'=>$_GET['proid']),true);
        $this->request_success($data);
    }

    public function index()
    {
//        $this->load->view('socket_front');
        $data = $this->load->view('welcome/welcomeView',null,true);
        $this->request_success($data);
    }

    public function front()
    {
        echo "<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta charset=\"UTF-8\">
  <script type=\"text/javascript\">
  var exampleSocket = new WebSocket(\"ws://127.0.0.1:2348\");
  exampleSocket.onopen = function (event) {
    exampleSocket.send(\"亲爱的服务器！我连上你啦！\"); 
  };
  exampleSocket.onmessage = function (event) {
    console.log(event.data);
    document.getElementById('content').innerHTML = event.data;
  }
  </script>
</head>
<body>
<input  type=\"text\" id=\"content\">
<button  onclick=\"exampleSocket.send( document.getElementById('content').value )\">发送</button>
<div id='content'></div>
</body>
</html>";
    }

    public function resize()
    {
        $this->load->helper('Image');

        $image_helper = load_class('Image');

        $source_path = STATICPATH . "img/16pic.jpg";
        $new_path = STATICPATH . "img/16pic.jpg";

        $aa = getimagesize($source_path);
        //x轴从这里开始剪裁
        $real_dataX = 0;
        //y轴从这里开始剪裁
        $real_dataY = 0;
        //x轴剪裁这么多
        $real_dataWidth = $aa["0"];

        //y轴剪裁这么多
        $real_dataHeight = $aa["1"];

        //按照原比例缩放到宽度为50px
        $real_dataHeight_where_width_is_50px = (int)((100 * $real_dataHeight) / $real_dataWidth);

        $image_helper->initialize(array(
                'source_image' => $source_path,
                'new_image' => $new_path,
                'width' => 100,   //剪裁以后的图片的 width 50
                'height' => $real_dataHeight_where_width_is_50px  //剪裁以后的图片的 height
            )
        )->resize($real_dataX, $real_dataY, $real_dataWidth, $real_dataHeight);
    }

    public function flat()
    {
        $this->load->helper('Image');

        $image_helper = new Image_helper();

        $source_path = STATICPATH . "img/logo8.png";
        $new_path = STATICPATH . "img/logo8.png";

        $aa = getimagesize($source_path);
        //x轴从这里开始剪裁
        $real_dataX = 0;
        //y轴从这里开始剪裁
        $real_dataY = 0;
        //x轴剪裁这么多
        $real_dataWidth = $aa["0"];

        //y轴剪裁这么多
        $real_dataHeight = $aa["1"];


        //如果只是想改变图片width和height
        //real_dataX real_dataY 均为0
        //real_dataWidth real_dataHeight 均为原图的高度

//        echo file_get_contents($source_path);die;

//        imagecolorat ( resource $image , int $x , int $y )


        for ($i = 0; $i < $real_dataHeight; $i++) {
            for ($j = 0; $j < $real_dataWidth; $j++) {
//                $im = imagecreatefromjpeg($source_path);
                $im = imagecreatefrompng($source_path);
                $rgb = ImageColorAt($im, $j, $i);

//        var_dump($rgb);die;

                $r = ($rgb >> 16) & 0xFF;
                $g = ($rgb >> 8) & 0xFF;
                $b = $rgb & 0xFF;

                $gray = $r * 0.299 + $g * 0.587 + $b * 0.114;

                if ($gray > 200) {
                    echo "<div style='width:18px;display:inline-block;color:darkgrey'>0&nbsp;</div>";
                } else {
                    echo "<div style='width:18px;display:inline-block;color:#3498DB'>8&nbsp;</div>";
                }

            }
            echo "<br>";
        }
        die;

//        $im = ImageCreateFromPng($source_path);
//        $rgb = ImageColorAt($im, 240, 240);
//
////        var_dump($rgb);die;
//
//        $r = ($rgb >> 16) & 0xFF;
//        $g = ($rgb >> 8) & 0xFF;
//        $b = $rgb & 0xFF;
//
//        $gray = $r*0.299 + $g*0.587 + $b*0.114;
//
//        var_dump($gray);die;


        //按照原比例缩放到宽度为50px
        $real_dataHeight_where_width_is_50px = (int)((50 * $real_dataHeight) / $real_dataWidth);

        $image_helper->initialize(array(
                'source_image' => $source_path,
                'new_image' => $new_path,
                'width' => 50,   //剪裁以后的图片的 width 50
                'height' => $real_dataHeight_where_width_is_50px  //剪裁以后的图片的 height
            )
        )->resize($real_dataX, $real_dataY, $real_dataWidth, $real_dataHeight);

    }

    public function crypt_ket()
    {


//        $plain_text = 'This is a plain-text message!';
//
//        $ciphertext = $this->encryption->encrypt($plain_text);
//
//        var_dump($this->encryption->decrypt($ciphertext+'aa'));

        $token = $this->create_token('郑相悦', '123456');

// Outputs: This is a plain-text message!
    }
}

